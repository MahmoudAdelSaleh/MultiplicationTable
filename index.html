<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VQYYZ3DM2Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VQYYZ3DM2Z');
</script>
<title>ğŸ² Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¶Ø±Ø¨ Ù„Ù„Ø£Ø·ÙØ§Ù„</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1982c4">
<style>
/* CSS Styles */
:root {
  --primary-color: #1982c4;
  --accent-color: #f96d00;
  --light-color: #fef6e4;
  --success-color: #4CAF50;
  --error-color: #F44336;
  --warning-color: #FFC107;
}

* {
  -webkit-tap-highlight-color: transparent;
  box-sizing: border-box;
}

body {
  font-family: 'Cairo', sans-serif;
  background-color: #fef6e4;
  text-align: center;
  margin: 0;
  padding-top: 50px;
  direction: rtl;
  touch-action: manipulation;
  overflow-x: hidden;
}

.top-tabs {
  position: fixed; 
  top: 0; 
  width: 100%; 
  background: #1982c4; 
  display: flex; 
  z-index: 999;
}
.top-tabs button {
  flex: 1; 
  color: white; 
  padding: 12px 5px; 
  font-size: 14px; 
  border: none; 
  background: #1982c4; 
  cursor: pointer; 
  transition: background 0.3s;
  min-height: 45px;
}
.top-tabs button:hover {
  background: #f96d00;
}
.top-tabs button.active-tab {
  background: #ff914d;
}
#time-bar, #quiz-time-bar {
  position: fixed; 
  top: 45px; 
  left: 0; 
  height: 6px; 
  background: green; 
  width: 0%; 
  z-index: 1000;
  border-radius: 4px; 
  transition: width linear;
}
.title-box {
  display: inline-block;
  background: linear-gradient(90deg, silver, gold, #b9f2ff, gold, silver);
  color: black;
  padding: 8px 16px;
  border-radius: 15px;
  font-size: 1.6em;
  margin: 10px auto;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
  max-width: 90%;
}
#tab-settings .title-box {
  font-size: 1.3em;
  padding: 5px 12px;
  border-radius: 10px;
}
#tab-settings .setting-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 10px;
  width: 100%;
}
#tab-settings label {
  width: 100%;
  text-align: center;
  margin-bottom: 5px;
  font-size: 0.9em;
}
#tab-settings input[type="range"],
#tab-settings input[type="text"],
#tab-settings input[type="color"] {
  width: 90%;
  max-width: 300px;
  padding: 8px;
  font-size: 16px; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø¹Ù„Ù‰ iOS */
}
#tab-settings button {
  margin-top: 5px;
  padding: 8px 12px;
}
.lang-toggle { 
  display: flex; 
  justify-content: center; 
  gap: 15px; 
  margin: 10px 0; 
}
.lang-btn {
  width: 45px; 
  height: 45px; 
  border-radius: 50%; 
  border: none; 
  color: white; 
  font-size: 1em; 
  font-weight: bold;
  cursor: pointer; 
  transition: background 0.3s;
}
.lang-btn.active { background: green; }
.lang-btn.inactive { background: red; }
#result {
  font-size: 1.8em; 
  background: #222;
  color: #0f0;
  padding: 10px;
  border-radius: 10px;
  margin: 10px auto;
  width: 95%;
  max-width: 500px;
  box-shadow: inset 0 0 8px #0f0, 0 0 10px rgba(0,0,0,0.4);
  min-height: 70px; 
  display: flex;
  justify-content: center;
  align-items: center;
  line-height: 1.3;
}
.numbers-wrapper { 
  display: flex; 
  justify-content: center; 
  align-items: center; 
  margin: 10px 0; 
  flex-wrap: wrap;
}
.group-box {
  background: #fff; 
  border: 2px solid #1982c4; 
  border-radius: 10px; 
  padding: 5px;
  display: flex; 
  flex-wrap: wrap; 
  justify-content: center; 
  max-width: 160px;
  margin: 0 5px;
}
.num {
  background: #1982c4; 
  color: white; 
  border-radius: 8px; 
  margin: 3px;
  width: 40px; 
  height: 40px; 
  display: flex; 
  justify-content: center; 
  align-items: center;
  font-size: 1.2em; 
  cursor: pointer; 
  transition: all 0.2s; 
  font-weight: bold;
  user-select: none;
  touch-action: manipulation;
}
.num:hover, .num:active {
  background: #f96d00; 
  transform: scale(1.1);
}
.num.selected { 
  background: #ff914d; 
  font-size: 1.5em; 
  transform: scale(1.2); 
}
.operator-box {
  font-size: 2.5em; 
  font-weight: bold; 
  margin: 0 10px;
  animation: rotateY 2s linear infinite;
  user-select: none;
}
@keyframes rotateY {
  0% { transform: rotateY(0deg); }
  100% { transform: rotateY(360deg); }
}
.tab { 
  display: none; 
  padding: 0 10px;
  overflow-x: hidden;
}
.tab.active { display: block; }
.reset-btn {
  background: #1982c4; 
  color: white; 
  border-radius: 8px; 
  padding: 10px 15px;
  margin: 10px 5px; 
  cursor: pointer; 
  border: none; 
  font-size: 1em; 
  transition: background 0.3s;
  min-height: 44px;
  min-width: 44px;
}
.reset-btn:hover, .reset-btn:active {
  background: #f96d00;
}
.quiz-options {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 8px;
  margin: 10px auto;
  max-width: 100%;
  padding-bottom: 10px;
}
.quiz-option {
  background: #1982c4;
  color: white;
  border-radius: 8px;
  padding: 10px 5px;
  font-size: 1.5em;
  cursor: pointer;
  flex: 1;
  min-width: 80px;
  max-width: 120px;
  transition: background 0.3s, transform 0.2s;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: relative;
  min-height: 70px;
  touch-action: manipulation;
}
.quiz-option:hover, .quiz-option:active { 
  background: #f96d00; 
  transform: scale(1.05); 
}
.quiz-option.clicked {
  pointer-events: none;
}
.quiz-option.correct {
  background-color: green!important;
}
.quiz-option.wrong {
  background-color: red!important;
}

#quiz-score-display {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 6px;
  margin-top: 15px;
  padding: 8px;
  background-color: #e0f2f7;
  border-radius: 10px;
  max-width: 100%;
  margin-left: auto;
  margin-right: auto;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
}

.score-dot {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  opacity: 0;
  transform: scale(0.5);
  transition: opacity 0.3s ease-out, transform 0.3s ease-out;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7em;
  color: white;
}

.score-dot.show {
  opacity: 1;
  transform: scale(1);
}

.score-dot.correct {
  background-color: #4CAF50;
}

.score-dot.wrong {
  background-color: #F44336;
}

.score-dot.timeout {
  background-color: #FFC107;
}

#quiz-question { 
  margin-top:10px; 
  font-size:1.8em; 
  padding: 0 10px;
  word-wrap: break-word;
}
.footer {
  background: linear-gradient(90deg, #c0c0c0, #dcdcdc, #c0c0c0);
  padding: 6px 0; 
  overflow: hidden; 
  height: 40px; 
  width: 100%; 
  position: fixed; 
  bottom: 0;
  box-shadow: 0 -2px 5px rgba(0,0,0,0.2);
}
.footer-content {
  white-space: nowrap;
  animation: scroll-right 15s linear infinite;
  font-size: 1.1em;
  display: flex;
  align-items: center;
}
@keyframes scroll-right {
  from { transform: translateX(-100%); }
  to { transform: translateX(100%); }
}
.footer-text {
  color: gold; 
  text-shadow: 1px 1px 2px black, 0 0 5px gold;
  margin-right: 10px;
}
.footer-content a img {
  vertical-align: middle; 
  margin: 0 6px; 
  width: 22px; 
  height: 22px;
  filter: drop-shadow(1px 1px 1px black) brightness(1.1);
  transition: transform 0.3s;
}
.footer-content a img:hover { 
  transform: scale(1.2); 
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 480px) {
  body {
    padding-top: 45px;
  }
  
  .top-tabs button {
    font-size: 12px;
    padding: 10px 3px;
  }
  
  .title-box {
    font-size: 1.4em;
    padding: 6px 12px;
  }
  
  #result {
    font-size: 1.5em;
    min-height: 60px;
    padding: 8px;
  }
  
  .num {
    width: 35px;
    height: 35px;
    font-size: 1em;
  }
  
  .operator-box {
    font-size: 2em;
    margin: 0 5px;
  }
  
  .quiz-option {
    font-size: 1.3em;
    min-width: 70px;
    min-height: 60px;
    padding: 8px 4px;
  }
  
  #quiz-question {
    font-size: 1.5em;
  }
  
  .reset-btn {
    padding: 8px 12px;
    font-size: 0.9em;
    margin: 8px 3px;
  }
  
  .lang-btn {
    width: 40px;
    height: 40px;
    font-size: 0.9em;
  }
  
  .footer {
    height: 35px;
  }
  
  .footer-content {
    font-size: 1em;
  }
}

@media (max-width: 360px) {
  .group-box {
    max-width: 140px;
  }
  
  .num {
    width: 30px;
    height: 30px;
    font-size: 0.9em;
    margin: 2px;
  }
  
  .quiz-option {
    min-width: 60px;
    font-size: 1.1em;
  }
}
</style>
</head>
<body>

<div id="time-bar"></div>
<div id="quiz-time-bar"></div>

<div class="top-tabs">
  <button id="tab-train-btn" class="active-tab" onclick="openTab('tab-train', this)">ğŸ² ØªØ¯Ø±ÙŠØ¨</button>
  <button id="tab-quiz-btn" onclick="openTab('tab-quiz', this)">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±</button>
  <button id="tab-settings-btn" onclick="openTab('tab-settings', this)">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<div class="tab active" id="tab-train">
  <div class="title-box">Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¶Ø±Ø¨ Ù„Ù„Ø£Ø·ÙØ§Ù„</div>
  <div class="lang-toggle">
    <button id="btn-ar" class="lang-btn active" onclick="switchLang(true)">Ù¡Ù¢Ù£</button>
    <button id="btn-en" class="lang-btn inactive" onclick="switchLang(false)">123</button>
  </div>
  <div id="result"><p>ğŸ¥³ Ø§Ø®ØªØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…!</p></div>
  <div class="numbers-wrapper">
    <div class="group-box" id="left"></div>
    <div class="operator-box">Ã—</div>
    <div class="group-box" id="right"></div>
  </div>
  <button class="reset-btn" onclick="resetScreen()">ğŸ”„ Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©</button>
</div>

<div class="tab" id="tab-quiz">
  <div class="title-box">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± (<span id="level-selected">Ù…Ø¨ØªØ¯Ø¦</span>)</div>
  <div id="quiz-question">?</div>
  <div class="quiz-options" id="quiz-options"></div>
  <div id="quiz-feedback" style="margin-top:8px; font-size:1.1em;"></div>
  <div id="score-text">âœ… 0 | âŒ 0 | 0%</div>
  <div id="quiz-score-display"></div>
  <div style="margin-top:10px;">
    <button class="reset-btn" onclick="selectLevel('Ù…Ø¨ØªØ¯Ø¦')">Ù…Ø¨ØªØ¯Ø¦</button>
    <button class="reset-btn" onclick="selectLevel('Ù†Ø´ÙŠØ·')">Ù†Ø´ÙŠØ·</button>
    <button class="reset-btn" onclick="selectLevel('Ø°ÙƒÙŠ')">Ø°ÙƒÙŠ</button>
    <button class="reset-btn" onclick="selectLevel('Ø¹Ø¨Ù‚Ø±ÙŠ')">Ø¹Ø¨Ù‚Ø±ÙŠ</button>
  </div>
  <button class="reset-btn" onclick="startQuiz()">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
</div>

<div class="tab" id="tab-settings">
  <div class="title-box">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  <div class="setting-item">
    <label>Ø­Ø¬Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
    <input type="range" min="1.5" max="4" step="0.1" value="2.2" onchange="document.querySelector('.title-box').style.fontSize=this.value+'em'">
  </div>
  <div class="setting-item">
    <label>Ø­Ø¬Ù… Ù†Øµ Ø§Ù„Ù…Ø³Ø£Ù„Ø©</label>
    <input type="range" min="1.5" max="4" step="0.1" value="2.5" onchange="document.getElementById('result').style.fontSize=this.value+'em'">
  </div>
  <div class="setting-item">
    <label>Ø­Ø¬Ù… Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
    <input type="range" min="1.5" max="3" step="0.1" value="2" onchange="document.getElementById('quiz-question').style.fontSize=this.value+'em'">
  </div>
  <div class="setting-item">
    <label>Ø­Ø¬Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø±</label>
    <input type="range" min="1" max="3" step="0.1" value="1.8" onchange="document.querySelectorAll('.quiz-option').forEach(e=>e.style.fontSize=this.value+'em')">
  </div>
  <div class="setting-item">
    <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø·Ù„</label>
    <input type="text" id="userNameInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" style="width: 200px; padding: 8px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px;">
    <button class="reset-btn" onclick="updateFooterName()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³Ù…</button>
  </div>
  <div class="setting-item">
    <label>Ø­Ø¬Ù… Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ­Ø±Ùƒ</label>
    <input type="range" min="0.8" max="2" step="0.1" value="1.2" onchange="document.querySelector('.footer-content').style.fontSize=this.value+'em'">
  </div>
  <div class="setting-item">
    <label>ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
    <input type="color" onchange="document.body.style.backgroundColor=this.value" style="height: 40px;">
  </div>
</div>

<div class="footer">
  <div class="footer-content" id="footer-content">
    <span class="footer-text" id="footer-text-content">Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø§Ø¯Ù„ ØµØ§Ù„Ø­ - Ù…Ø¹Ù„Ù… Ø±ÙŠØ§Ø¶ÙŠØ§Øª</span>
    <a href="https://m.facebook.com/barghouthean/" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/733/733547.png" alt="ÙÙŠØ³Ø¨ÙˆÙƒ"></a>
    <a href="https://wa.me/201552402912" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="ÙˆØ§ØªØ³Ø§Ø¨"></a>
    <a href="mailto:mahmoudadelsaleh@gmail.com"><img src="https://cdn-icons-png.flaticon.com/512/732/732200.png" alt="Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"></a>
  </div>
</div>

<audio id="sound-clap" src="true.mp3"></audio>
<audio id="sound-wrong" src="wrong.mp3"></audio>

<script>
// service worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
  .then(reg => console.log('Service Worker registered:', reg.scope))
  .catch(err => console.error('Service Worker error:', err));
}

let useArabic = true;
let leftSelected = null, rightSelected = null;
let quiz = {
  left: 0,
  right: 0,
  correctAnswer: 0,
  correctCount: 0,
  wrongCount: 0,
  currentQuestion: 0,
  totalQuestions: 10,
  questionTimeout: 6000,
  questionTimer: null
};

// DOM elements cache
const leftGroup = document.getElementById('left');
const rightGroup = document.getElementById('right');
const timeBar = document.getElementById('time-bar');
const quizTimeBar = document.getElementById('quiz-time-bar');
const resultDisplay = document.getElementById('result');
const quizQuestionDisplay = document.getElementById('quiz-question');
const quizOptionsDisplay = document.getElementById('quiz-options');
const quizFeedbackDisplay = document.getElementById('quiz-feedback');
const scoreTextDisplay = document.getElementById('score-text');
const quizScoreDisplay = document.getElementById('quiz-score-display');
const soundClap = document.getElementById('sound-clap');
const soundWrong = document.getElementById('sound-wrong');

// Utility functions
const toArabic = n => n.toString().replace(/\d/g, d => 'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[d]);
const fromNumber = n => useArabic? toArabic(n) : n;

// Tab management
function openTab(tabId, btn) {
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  document.querySelectorAll('.top-tabs button').forEach(b => b.classList.remove('active-tab'));
  btn.classList.add('active-tab');
  if (tabId === 'tab-quiz') {
    if (window.showResultInterval) clearInterval(window.showResultInterval);
    timeBar.style.width = '0%';
  }
}

// Language switching
function switchLang(arabic) {
  useArabic = arabic;
  document.getElementById('btn-ar').className = arabic? 'lang-btn active' : 'lang-btn inactive';
  document.getElementById('btn-en').className =!arabic? 'lang-btn active' : 'lang-btn inactive';
  document.body.style.direction = arabic? 'rtl' : 'ltr';
  createNumberButtons();
  resetScreen();
}

// Training tab logic
function createNumberButtons() {
  leftGroup.innerHTML = '';
  rightGroup.innerHTML = '';
  for (let i = 1; i <= 10; i++) {
    ['left', 'right'].forEach(side => {
      let btn = document.createElement('div');
      btn.className = 'num';
      btn.textContent = fromNumber(i);
      btn.addEventListener('click', () => selectNumber(side, btn, i));
      (side === 'left'? leftGroup : rightGroup).appendChild(btn);
    });
  }
}

function selectNumber(side, btn, num) {
  if (side === 'left') {
    if (leftSelected) leftSelected.classList.remove('selected');
    leftSelected = btn;
  } else {
    if (rightSelected) rightSelected.classList.remove('selected');
    rightSelected = btn;
  }
  btn.classList.add('selected');
  showResult();
}

function showResult() {
  if (leftSelected && rightSelected) {
    // ØªÙ… ØªØµØ­ÙŠØ­ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
    let ln = parseInt(leftSelected.textContent.replace(/[Ù -Ù©]/g, d => '0123456789'['Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d)]));
    // ØªÙ… ØªØµØ­ÙŠØ­ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
    let rn = parseInt(rightSelected.textContent.replace(/[Ù -Ù©]/g, d => '0123456789'['Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d)]));
    resultDisplay.innerHTML = `<p>${fromNumber(ln)} Ã— ${fromNumber(rn)} = ${fromNumber(ln * rn)}</p>`;
    if (window.showResultInterval) clearInterval(window.showResultInterval);
    timeBar.style.transition = 'none';
    timeBar.style.width = '100%';
    setTimeout(() => {
      timeBar.style.transition = 'width 3s linear';
      timeBar.style.width = '0%';
      window.showResultInterval = setTimeout(() => resetScreen(), 3000);
    }, 10);
  }
}

function resetScreen() {
  if (leftSelected) leftSelected.classList.remove('selected');
  if (rightSelected) rightSelected.classList.remove('selected');
  leftSelected = rightSelected = null;
  resultDisplay.innerHTML = '<p>ğŸ¥³ Ø§Ø®ØªØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…!</p>';
  timeBar.style.transition = 'none';
  timeBar.style.width = '0%';
  if (window.showResultInterval) clearTimeout(window.showResultInterval);
}

// Quiz tab logic
function selectLevel(level) {
  const levels = {
    'Ù…Ø¨ØªØ¯Ø¦': { totalQuestions: 10, timeout: 6000 },
    'Ù†Ø´ÙŠØ·': { totalQuestions: 20, timeout: 4000 },
    'Ø°ÙƒÙŠ': { totalQuestions: 30, timeout: 3000 },
    'Ø¹Ø¨Ù‚Ø±ÙŠ': { totalQuestions: 40, timeout: 2000 }
  };
  quiz.totalQuestions = levels[level].totalQuestions;
  quiz.questionTimeout = levels[level].timeout;
  document.getElementById('level-selected').textContent = level;
}

function startQuiz() {
  quiz.correctCount = 0;
  quiz.wrongCount = 0;
  quiz.currentQuestion = 0;
  scoreTextDisplay.textContent = `âœ… 0 | âŒ 0 | 0%`;
  quizFeedbackDisplay.textContent = '';
  quizScoreDisplay.innerHTML = '';
  nextQuiz();
}

function nextQuiz() {
  clearTimeout(quiz.questionTimer);
  if (quiz.currentQuestion >= quiz.totalQuestions) {
    showQuizResult();
    return;
  }

  document.querySelectorAll('.quiz-option.correct,.quiz-option.wrong').forEach(option => {
    option.classList.remove('correct', 'wrong');
  });

  quiz.currentQuestion++;
  quiz.left = Math.ceil(Math.random() * 10);
  quiz.right = Math.ceil(Math.random() * 10);
  quiz.correctAnswer = quiz.left * quiz.right;

  const qText = useArabic? `${fromNumber(quiz.left)} Ã— ${fromNumber(quiz.right)} = ØŸ` : `${quiz.left} Ã— ${quiz.right} =?`;
  quizQuestionDisplay.textContent = qText;
  quizFeedbackDisplay.textContent = '';

  const options = [quiz.correctAnswer];
  while (options.length < 3) {
    let fake = quiz.correctAnswer + (Math.floor(Math.random() * 5) - 2);
    if (fake > 0 &&!options.includes(fake)) {
      options.push(fake);
    }
  }
  options.sort(() => Math.random() - 0.5);

  quizOptionsDisplay.innerHTML = options.map(n =>
    `<div class="quiz-option" onclick="checkQuiz(${n}, this)">
        ${fromNumber(n)}
    </div>`).join('');

  quizTimeBar.style.transition = 'none';
  quizTimeBar.style.width = '100%';
  setTimeout(() => {
    quizTimeBar.style.transition = `width ${quiz.questionTimeout / 1000}s linear`;
    quizTimeBar.style.width = '0%';
    quiz.questionTimer = setTimeout(() => checkQuiz(null), quiz.questionTimeout);
  }, 10);
}

const addScoreDot = (type) => {
  const dot = document.createElement('div');
  dot.classList.add('score-dot', type);
  quizScoreDisplay.appendChild(dot);
  setTimeout(() => dot.classList.add('show'), 10);
};

function checkQuiz(selected, el) {
  clearTimeout(quiz.questionTimer);

  document.querySelectorAll('.quiz-option').forEach(option => {
    option.style.pointerEvents = 'none';
  });

  const allOptions = Array.from(quizOptionsDisplay.children);

  if (selected === quiz.correctAnswer) {
    quiz.correctCount++;
    if (el) el.classList.add('correct');
    addScoreDot('correct');
    soundClap.play();
    quizFeedbackDisplay.textContent = 'âœ… Ø£Ø­Ø³Ù†Øª!';
  } else if (selected!== null) {
    quiz.wrongCount++;
    if (el) el.classList.add('wrong');
    addScoreDot('wrong');
    soundWrong.play();
    const correctAnswerEl = allOptions.find(option => option.textContent == fromNumber(quiz.correctAnswer));
    if (correctAnswerEl) correctAnswerEl.classList.add('correct');
    quizFeedbackDisplay.textContent = `âŒ Ø®Ø·Ø£! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ ${fromNumber(quiz.correctAnswer)}`;
  } else {
    quiz.wrongCount++;
    addScoreDot('timeout');
    soundWrong.play();
    quizFeedbackDisplay.textContent = `â° Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª! Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ ${fromNumber(quiz.correctAnswer)}`;
    const correctAnswerEl = allOptions.find(option => option.textContent == fromNumber(quiz.correctAnswer));
    if (correctAnswerEl) correctAnswerEl.classList.add('correct');
  }

  const percent = Math.round((quiz.correctCount / quiz.totalQuestions) * 100);
  scoreTextDisplay.textContent = `âœ… ${fromNumber(quiz.correctCount)} | âŒ ${fromNumber(quiz.wrongCount)} | ${percent}%`;

  setTimeout(nextQuiz, 1500);
}

function showQuizResult() {
  const percent = Math.round((quiz.correctCount / quiz.totalQuestions) * 100);
  let msg = '';
  if (percent > 80) {
    msg = 'ğŸ‘ Ø±Ø§Ø¦Ø¹! Ø¬Ø±Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø£ØµØ¹Ø¨!';
  } else if (percent > 50) {
    msg = 'âœ¨ Ø¬ÙŠØ¯! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­Ø³Ù†.';
  } else {
    msg = 'ğŸ”„ Ù„Ø§ Ø¨Ø£Ø³ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!';
  }

  quizFeedbackDisplay.innerHTML = `
    <p>Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±!</p>
    <p>âœ… ${fromNumber(quiz.correctCount)} Ù…Ù† ${fromNumber(quiz.totalQuestions)} (${percent}%) - ${msg}</p>
  `;
  quizTimeBar.style.width = '0%';
}

function updateFooterName() {
  const userName = document.getElementById('userNameInput').value.trim();
  const footerContent = document.getElementById('footer-content');

  if (userName) {
    footerContent.innerHTML = `<span class="footer-text">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${userName}!</span>`;
  } else {
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø±ØºØ§Ù‹ØŒ Ù†Ø¹ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    footerContent.innerHTML = `
      <span class="footer-text">Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø§Ø¯Ù„ ØµØ§Ù„Ø­ - Ù…Ø¹Ù„Ù… Ø±ÙŠØ§Ø¶ÙŠØ§Øª</span>
      <a href="https://m.facebook.com/barghouthean/" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/733/733547.png" alt="ÙÙŠØ³Ø¨ÙˆÙƒ"></a>
      <a href="https://wa.me/201552402912" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="ÙˆØ§ØªØ³Ø§Ø¨"></a>
      <a href="mailto:mahmoudadelsaleh@gmail.com"><img src="https://cdn-icons-png.flaticon.com/512/732/732200.png" alt="Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"></a>
    `;
  }
}

// Initial setup
createNumberButtons();
switchLang(true);
selectLevel('Ù…Ø¨ØªØ¯Ø¦');
openTab('tab-train', document.getElementById('tab-train-btn'));

// Ù…Ù†Ø¹ Ø³Ù„ÙˆÙƒ Ø§Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ§Ù„
document.addEventListener('touchstart', function(event) {
  if (event.touches.length > 1) {
    event.preventDefault();
  }
}, { passive: false });

let lastTouchEnd = 0;
document.addEventListener('touchend', function(event) {
  const now = (new Date()).getTime();
  if (now - lastTouchEnd <= 300) {
    event.preventDefault();
  }
  lastTouchEnd = now;
}, { passive: false });
</script>

</body>
</html>