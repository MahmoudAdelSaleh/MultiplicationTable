<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ² Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¶Ø±Ø¨ Ù„Ù„Ø£Ø·ÙØ§Ù„</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1982c4">
<style>
body {
  font-family: 'Cairo', sans-serif;
  background-color: #fef6e4;
  text-align: center;
  margin: 0;
  padding-top: 60px;
  direction: rtl;
}
.top-tabs {
  position: fixed; top: 0; width: 100%; background: #1982c4; display: flex; z-index: 999;
}
.top-tabs button {
  flex: 1; color: white; padding: 10px; font-size: 1em; border: none; background: #1982c4;
}
#time-bar, #quiz-time-bar {
  position: fixed; top: 45px; left: 0; height: 10px; background: green; width: 0%; z-index: 1000;
  border-radius: 4px;
}
.title-box {
  display: inline-block;
  background: linear-gradient(90deg, silver, gold, #b9f2ff, gold, silver);
  color: black;
  padding: 8px 16px;
  border-radius: 15px;
  font-size: 2.2em;
  margin: 10px auto;
  box-shadow: 0 0 10px rgba(0,0,0,0.3);
}
.lang-toggle { display: flex; justify-content: center; gap: 20px; margin: 10px 0; }
.lang-btn {
  width: 50px; height: 50px; border-radius: 50%; border: none; color: white; font-size: 1.2em; font-weight: bold;
  cursor: pointer; transition: background 0.3s;
}
.lang-btn.active { background: green; }
.lang-btn.inactive { background: red; }
#result {
  font-size: 1.4em;
  background: #222; color: #0f0; padding: 6px;
  border-radius: 10px; margin: 10px auto;
  width: 95%; max-width: 500px;
  box-shadow: inset 0 0 8px #0f0, 0 0 10px rgba(0,0,0,0.4);
}
.numbers-wrapper { display: flex; justify-content: center; align-items: center; margin: 10px 0; }
.group-box {
  background: #fff; border: 2px solid #1982c4; border-radius: 10px; padding: 5px;
  display: flex; flex-wrap: wrap; justify-content: center; max-width: 160px;
}
.num {
  background: #1982c4; color: white; border-radius: 8px; margin: 3px;
  width: 40px; height: 40px; display: flex; justify-content: center; align-items: center;
  font-size: 1.2em; cursor: pointer; transition: all 0.2s; font-weight: bold;
}
.num.selected { background: #ff914d; font-size: 1.5em; }
.operator-box {
  font-size: 4em; font-weight: bold; margin: 0 20px;
  animation: rotateY 2s linear infinite;
}
@keyframes rotateY {
  0% { transform: rotateY(0deg); }
  100% { transform: rotateY(360deg); }
}
.tab { display: none; }
.reset-btn {
  background: #1982c4; color: white; border-radius: 8px; padding: 6px 12px;
  margin-top: 10px; cursor: pointer; border: none; font-size: 1em;
}
.quiz-options { display: flex; justify-content: center; gap: 10px; margin: 10px auto; max-width: 90%; }
.quiz-option {
  background: #1982c4; color: white; border-radius: 8px; padding: 6px 12px;
  font-size: 1.8em; cursor: pointer; flex: 1; transition: background 0.3s;
}
.quiz-option:hover { background: #f96d00; }
#quiz-question { margin-top:10px; font-size:2em; }
.footer {
  background: linear-gradient(90deg, #c0c0c0, #dcdcdc, #c0c0c0);
  padding: 6px 0; overflow: hidden; height: 40px; width: 100%; position: fixed; bottom: 0;
}
.footer-content {
  white-space: nowrap;
  animation: scroll-right 10s linear infinite;
  font-size: 1.2em;
}
@keyframes scroll-right {
  from { transform: translateX(-100%); }
  to { transform: translateX(100%); }
}
.footer-text {
  color: gold; text-shadow: 1px 1px 2px black, 0 0 5px gold;
  margin-right: 10px;
}
.footer-content a img {
  vertical-align: middle; margin: 0 6px; width: 24px; height: 24px;
  filter: drop-shadow(1px 1px 1px black) brightness(1.1);
  transition: transform 0.3s;
}
.footer-content a img:hover { transform: scale(1.2); }
</style>
</head>
<body>

<div id="time-bar"></div>
<div id="quiz-time-bar"></div>

<div class="top-tabs">
  <button onclick="openTab('tab-train')">ğŸ² ØªØ¯Ø±ÙŠØ¨</button>
  <button onclick="openTab('tab-quiz')">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø±</button>
  <button onclick="openTab('tab-settings')">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</div>

<div class="tab" id="tab-train" style="display:block;">
  <div class="title-box">âœ¨ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¶Ø±Ø¨ Ù„Ù„Ø£Ø·ÙØ§Ù„ âœ¨</div>
  <div class="lang-toggle">
    <button id="btn-ar" class="lang-btn active" onclick="switchLang(true)">Ù¡Ù¢Ù£</button>
    <button id="btn-en" class="lang-btn inactive" onclick="switchLang(false)">123</button>
  </div>
  <div id="result"><p>ğŸ¥³ Ø§Ø®ØªØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…!</p></div>
  <div class="numbers-wrapper">
    <div class="group-box" id="left"></div>
    <div class="operator-box">Ã—</div>
    <div class="group-box" id="right"></div>
  </div>
  <button class="reset-btn" onclick="resetScreen()">ğŸ”„ Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Ø´Ø©</button>
</div>

<div class="tab" id="tab-quiz">
  <div class="title-box">ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± (<span id="level-selected">Ù…Ø¨ØªØ¯Ø¦</span>)</div>
  <div id="quiz-question">?</div>
  <div class="quiz-options" id="quiz-options"></div>
  <div id="quiz-feedback" style="margin-top:8px; font-size:1.1em;"></div>
  <div id="score-text">âœ… 0 | âŒ 0 | 0%</div>
  <div style="margin-top:10px;">
    <button class="reset-btn" onclick="selectLevel('Ù…Ø¨ØªØ¯Ø¦')">Ù…Ø¨ØªØ¯Ø¦</button>
    <button class="reset-btn" onclick="selectLevel('Ù†Ø´ÙŠØ·')">Ù†Ø´ÙŠØ·</button>
    <button class="reset-btn" onclick="selectLevel('Ø°ÙƒÙŠ')">Ø°ÙƒÙŠ</button>
    <button class="reset-btn" onclick="selectLevel('Ø¹Ø¨Ù‚Ø±ÙŠ')">Ø¹Ø¨Ù‚Ø±ÙŠ</button>
  </div>
  <button class="reset-btn" onclick="startQuiz()">ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
</div>

<div class="tab" id="tab-settings">
  <div class="title-box">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  <label>Ø­Ø¬Ù… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <input type="range" min="1.5" max="4" step="0.1" value="2.2" onchange="document.querySelector('.title-box').style.fontSize=this.value+'em'"></label><br>
  <label>Ø­Ø¬Ù… Ø´Ø§Ø´Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© <input type="range" min="1" max="3" step="0.1" value="1.4" onchange="document.getElementById('result').style.fontSize=this.value+'em'"></label><br>
  <label>Ø­Ø¬Ù… Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„ <input type="range" min="1.5" max="3" step="0.1" value="2" onchange="document.getElementById('quiz-question').style.fontSize=this.value+'em'"></label><br>
  <label>Ø­Ø¬Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± <input type="range" min="1" max="3" step="0.1" value="1.8" onchange="document.querySelectorAll('.quiz-option').forEach(e=>e.style.fontSize=this.value+'em')"></label><br>
  <label>Ø­Ø¬Ù… Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ­Ø±Ùƒ <input type="range" min="0.8" max="2" step="0.1" value="1.2" onchange="document.querySelector('.footer-content').style.fontSize=this.value+'em'"></label><br>
  <label>ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© <input type="color" onchange="document.body.style.backgroundColor=this.value"></label>
</div>

<div class="footer">
  <div class="footer-content">
    <span class="footer-text">Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø§Ø¯Ù„ ØµØ§Ù„Ø­ - Ù…Ø¹Ù„Ù… Ø±ÙŠØ§Ø¶ÙŠØ§Øª</span>
    <a href="https://www.facebook.com/share/16vNKvdAze/" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/733/733547.png"></a>
    <a href="https://wa.me/201552402913" target="_blank"><img src="https://cdn-icons-png.flaticon.com/512/733/733585.png"></a>
    <a href="mailto:mahmoudadelsaleh@gmail.com"><img src="https://cdn-icons-png.flaticon.com/512/732/732200.png"></a>
  </div>
</div>

<audio id="sound-clap" src="clap.mp3"></audio>
<audio id="sound-wrong" src="wrong.mp3"></audio>

<script>
// service worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .then(reg => console.log('Service Worker registered:', reg.scope))
    .catch(err => console.error('Service Worker error:', err));
}
let useArabic = true;
let leftSelected = null, rightSelected = null;
let quizLeft = 0, quizRight = 0, correctAnswer = 0;
let correctCount = 0, wrongCount = 0, currentQuestion = 0;
let totalQuestions = 10, questionTimeout = 6000;
let questionTimer;
const leftGroup = document.getElementById('left');
const rightGroup = document.getElementById('right');
const timeBar = document.getElementById('time-bar');
const quizTimeBar = document.getElementById('quiz-time-bar');
const soundClap = document.getElementById('sound-clap');
const soundWrong = document.getElementById('sound-wrong');

function toArabic(n) { return n.toString().replace(/\d/g,d=>'Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'[d]); }
function fromNumber(n) { return useArabic ? toArabic(n) : n; }

function switchLang(arabic) {
  useArabic=arabic;
  document.getElementById('btn-ar').className= arabic?'lang-btn active':'lang-btn inactive';
  document.getElementById('btn-en').className= !arabic?'lang-btn active':'lang-btn inactive';
  document.body.style.direction= arabic?'rtl':'ltr';
  createNumberButtons();
  resetScreen();
}

function openTab(tabId){
  document.querySelectorAll('.tab').forEach(tab=>tab.style.display='none');
  document.getElementById(tabId).style.display='block';
}

function createNumberButtons(){
  leftGroup.innerHTML=''; rightGroup.innerHTML='';
  for(let i=1;i<=10;i++){
    ['left','right'].forEach(side=>{
      let btn=document.createElement('div');
      btn.className='num'; btn.textContent=fromNumber(i);
      btn.onclick=()=>{ selectNumber(side,btn,i); };
      (side==='left'?leftGroup:rightGroup).appendChild(btn);
    });
  }
}

function selectNumber(side,btn,num){
  if(side==='left'){ if(leftSelected) leftSelected.classList.remove('selected'); leftSelected=btn; }
  else{ if(rightSelected) rightSelected.classList.remove('selected'); rightSelected=btn; }
  btn.classList.add('selected'); showResult();
}

function showResult(){
  if(leftSelected && rightSelected){
    let ln=parseInt(leftSelected.textContent.replace(/[Ù -Ù©]/g,d=>'0123456789'['Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d)]));
    let rn=parseInt(rightSelected.textContent.replace(/[Ù -Ù©]/g,d=>'0123456789'['Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©'.indexOf(d)]));
    document.getElementById('result').innerHTML=`<p>${fromNumber(ln)} Ã— ${fromNumber(rn)} = ${fromNumber(ln*rn)}</p>`;
    timeBar.style.width='100%';
    let width=100;
    let interval=setInterval(()=>{
      width-=5;
      timeBar.style.width=width+'%';
      if(width<=0){
        clearInterval(interval);
        resetScreen();
        timeBar.style.width='0%';
      }
    },40);
  }
}

function resetScreen(){
  if(leftSelected) leftSelected.classList.remove('selected');
  if(rightSelected) rightSelected.classList.remove('selected');
  leftSelected=rightSelected=null;
  document.getElementById('result').innerHTML='<p>ğŸ¥³ Ø§Ø®ØªØ± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…!</p>';
}

function selectLevel(level){
  if(level==='Ù…Ø¨ØªØ¯Ø¦'){ totalQuestions=10; questionTimeout=6000; }
  else if(level==='Ù†Ø´ÙŠØ·'){ totalQuestions=20; questionTimeout=4000; }
  else if(level==='Ø°ÙƒÙŠ'){ totalQuestions=30; questionTimeout=3000; }
  else if(level==='Ø¹Ø¨Ù‚Ø±ÙŠ'){ totalQuestions=40; questionTimeout=2000; }
  document.getElementById('level-selected').textContent=level;
}

function startQuiz(){
  correctCount=wrongCount=currentQuestion=0;
  nextQuiz();
}

function nextQuiz(){
  if(currentQuestion>=totalQuestions){
    showQuizResult();
    return;
  }
  currentQuestion++;
  quizLeft=Math.ceil(Math.random()*10); quizRight=Math.ceil(Math.random()*10);
  correctAnswer=quizLeft*quizRight;
  let qText=useArabic?`${fromNumber(quizLeft)} Ã— ${fromNumber(quizRight)} = ØŸ`:`${quizLeft} Ã— ${quizRight} = ?`;
  document.getElementById('quiz-question').textContent=qText;
  document.getElementById('quiz-feedback').textContent='';
  let options=[correctAnswer];
  while(options.length<3){
    let fake=correctAnswer+(Math.floor(Math.random()*5)-2);
    if(fake>0 && !options.includes(fake)) options.push(fake);
  }
  options.sort(()=>Math.random()-0.5);
  document.getElementById('quiz-options').innerHTML=options.map(n=>
    `<div class="quiz-option" onclick="checkQuiz(${n}, this)">${fromNumber(n)}</div>`).join('');
  quizTimeBar.style.width='100%';
  animateBar(quizTimeBar, questionTimeout);
  questionTimer=setTimeout(()=>{ checkQuiz(null); },questionTimeout);
}

function checkQuiz(selected,el){
  if(document.querySelector('.quiz-option.clicked')) return;
  clearTimeout(questionTimer);
  if(el) el.classList.add('clicked');
  if(selected===correctAnswer){
    correctCount++; soundClap.play();
    document.getElementById('quiz-feedback').textContent='âœ… Ø£Ø­Ø³Ù†Øª!';
  }else{
    wrongCount++; soundWrong.play();
    document.getElementById('quiz-feedback').textContent=`âŒ Ø®Ø·Ø£! Ø§Ù„ØµØ­ Ù‡Ùˆ ${fromNumber(correctAnswer)}`;
  }
  let percent=Math.round((correctCount/totalQuestions)*100);
  document.getElementById('score-text').textContent=`âœ… ${fromNumber(correctCount)} | âŒ ${fromNumber(wrongCount)} | ${percent}%`;
  setTimeout(nextQuiz,500);
}

function animateBar(bar,duration){
  let width=100;
  let interval=50;
  let decrement=100/(duration/interval);
  let timer=setInterval(()=>{
    width-=decrement;
    bar.style.width=width+'%';
    if(width<=0) clearInterval(timer);
  },interval);
}

function showQuizResult(){
  let percent=Math.round((correctCount/totalQuestions)*100);
  let msg= percent>80?'ğŸ‘ Ø±Ø§Ø¦Ø¹! Ø¬Ø±Ø¨ Ù…Ø³ØªÙˆÙ‰ Ø£ØµØ¹Ø¨!' : 'âœ¨ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!';
  document.getElementById('quiz-feedback').textContent=`âœ… ${fromNumber(correctCount)} Ù…Ù† ${fromNumber(totalQuestions)} (${percent}%) - ${msg}`;
  quizTimeBar.style.width='0%';
}

createNumberButtons(); switchLang(true); selectLevel('Ù…Ø¨ØªØ¯Ø¦');
</script>

</body>
</html>